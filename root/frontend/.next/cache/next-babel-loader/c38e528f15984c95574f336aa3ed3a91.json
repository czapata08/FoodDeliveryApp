{"ast":null,"code":"var _jsxFileName = \"/Users/carloszapata/Desktop/CAPSTONE/setting-up-graphql-with-apollo_starter/frontend/lib/auth2.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect, createContext, useContext, useState } from \"react\";\nimport Router from \"next/router\";\nimport axios from \"axios\";\nimport Cookies from \"js-cookie\";\nimport { responsePathAsArray } from \"graphql\";\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:1337\";\nimport api from \"../services/api\";\nconst AuthContext = /*#__PURE__*/createContext({});\nexport const AuthProvider = ({\n  children\n}) => {\n  const {\n    0: user,\n    1: setUser\n  } = useState(null);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  useEffect(() => {\n    async function loadUserFromCookies() {\n      const token = Cookies.get(\"token\");\n      console.log(JSON.stringify(Cookies.get()));\n\n      if (token) {\n        console.log(\"Got a token in the cookies, let's see if it is valid\");\n        api.defaults.headers.Authorization = `Bearer ${token}`;\n        const {\n          user: user\n        } = await api.get(\"users/me\");\n        if (user) setUser(user);\n      }\n\n      setLoading(false);\n    }\n\n    loadUserFromCookies();\n  }, []); //CAN'T GET USER TO UPDATE\n\n  const login = (identifier, password) => {\n    //prevent function from being ran on the server\n    if (true) {\n      return;\n    }\n\n    return new Promise((resolve, reject) => {\n      axios.post(`${API_URL}/auth/local/`, {\n        identifier,\n        password\n      }).then(res => {\n        //set token response from Strapi for server validation\n        Cookies.set(\"token\", res.data.jwt); //set user with data response\n\n        const {\n          user: user\n        } = res.data;\n        setUser(user);\n        console.log(`AUTHENTICATED LOGIN USER = ${JSON.stringify(user)}`); //resolve the promise to set loading to false in SignUp form\n\n        resolve(res); //redirect back to home page for restaurance selection\n\n        Router.push(\"/\");\n      }).catch(error => {\n        //reject the promise and pass the error object back to the form\n        reject(error);\n      });\n    });\n  };\n\n  const registerUser = (username, email, password) => {\n    //prevent function from being ran on the server\n    //to make sure that it is on the client side,\n    //if window is not defined, than it is running on server\n    if (true) {\n      return;\n    }\n\n    return new Promise((resolve, reject) => {\n      axios.post(`${API_URL}/auth/local/register`, {\n        username,\n        email,\n        password\n      }).then(res => {\n        //use Cookie capability to store JWT token\n        //set token response from Strapi for server validation\n        Cookies.set(\"token\", res.data.jwt);\n        const {\n          user: user\n        } = res.data;\n        setUser(user);\n        console.log(`USER HAS BEEN REGISTERED, USER = ${user}`); //resolve the promise to set loading to false in SignUp form\n\n        resolve(res); //redirect back to home page for restaurance selection\n\n        Router.push(\"/\");\n      }).catch(error => {\n        //reject the promise and pass the error object back to the form\n        reject(error);\n      });\n    });\n  };\n\n  const logout = (email, password) => {\n    //remove token and user cookie\n    Cookies.remove(\"token\");\n    delete window.__user; // sync logout between multiple windows\n\n    window.localStorage.setItem(\"logout\", Date.now()); //Set user to null\n\n    setUser(null);\n    headerToken = \"\"; //redirect to the home page\n\n    Router.push(\"/\");\n  };\n\n  return __jsx(AuthContext.Provider, {\n    value: {\n      isAuthenticated: !!user,\n      user,\n      login,\n      registerUser,\n      loading,\n      logout\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 5\n    }\n  }, children);\n};\nexport const useAuth = () => useContext(AuthContext);","map":{"version":3,"sources":["/Users/carloszapata/Desktop/CAPSTONE/setting-up-graphql-with-apollo_starter/frontend/lib/auth2.js"],"names":["useEffect","createContext","useContext","useState","Router","axios","Cookies","responsePathAsArray","API_URL","process","env","NEXT_PUBLIC_API_URL","api","AuthContext","AuthProvider","children","user","setUser","loading","setLoading","loadUserFromCookies","token","get","console","log","JSON","stringify","defaults","headers","Authorization","login","identifier","password","Promise","resolve","reject","post","then","res","set","data","jwt","push","catch","error","registerUser","username","email","logout","remove","window","__user","localStorage","setItem","Date","now","headerToken","isAuthenticated","useAuth"],"mappings":"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","sourcesContent":["import { useEffect, createContext, useContext, useState } from \"react\";\nimport Router from \"next/router\";\nimport axios from \"axios\";\nimport Cookies from \"js-cookie\";\nimport { responsePathAsArray } from \"graphql\";\n\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:1337\";\n\nimport api from \"../services/api\";\n\nconst AuthContext = createContext({});\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    async function loadUserFromCookies() {\n      const token = Cookies.get(\"token\");\n      console.log(JSON.stringify(Cookies.get()));\n      if (token) {\n        console.log(\"Got a token in the cookies, let's see if it is valid\");\n        api.defaults.headers.Authorization = `Bearer ${token}`;\n        const { user: user } = await api.get(\"users/me\");\n        if (user) setUser(user);\n      }\n      setLoading(false);\n    }\n    loadUserFromCookies();\n  }, []);\n  //CAN'T GET USER TO UPDATE\n  const login = (identifier, password) => {\n    //prevent function from being ran on the server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    return new Promise((resolve, reject) => {\n      axios\n        .post(`${API_URL}/auth/local/`, { identifier, password })\n        .then((res) => {\n          //set token response from Strapi for server validation\n          Cookies.set(\"token\", res.data.jwt);\n          //set user with data response\n          const { user: user } = res.data;\n          setUser(user);\n          console.log(`AUTHENTICATED LOGIN USER = ${JSON.stringify(user)}`);\n          //resolve the promise to set loading to false in SignUp form\n          resolve(res);\n          //redirect back to home page for restaurance selection\n          Router.push(\"/\");\n        })\n        .catch((error) => {\n          //reject the promise and pass the error object back to the form\n          reject(error);\n        });\n    });\n  };\n\n  const registerUser = (username, email, password) => {\n    //prevent function from being ran on the server\n    //to make sure that it is on the client side,\n    //if window is not defined, than it is running on server\n    if (typeof window === \"undefined\") {\n      return;\n    }\n    return new Promise((resolve, reject) => {\n      axios\n        .post(`${API_URL}/auth/local/register`, { username, email, password })\n        .then((res) => {\n          //use Cookie capability to store JWT token\n          //set token response from Strapi for server validation\n          Cookies.set(\"token\", res.data.jwt);\n          const { user: user } = res.data;\n          setUser(user);\n          console.log(`USER HAS BEEN REGISTERED, USER = ${user}`);\n          //resolve the promise to set loading to false in SignUp form\n          resolve(res);\n          //redirect back to home page for restaurance selection\n          Router.push(\"/\");\n        })\n        .catch((error) => {\n          //reject the promise and pass the error object back to the form\n          reject(error);\n        });\n    });\n  };\n\n  const logout = (email, password) => {\n    //remove token and user cookie\n    Cookies.remove(\"token\");\n    delete window.__user;\n    // sync logout between multiple windows\n    window.localStorage.setItem(\"logout\", Date.now());\n    //Set user to null\n    setUser(null);\n    headerToken = \"\";\n    //redirect to the home page\n    Router.push(\"/\");\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        isAuthenticated: !!user,\n        user,\n        login,\n        registerUser,\n        loading,\n        logout,\n      }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => useContext(AuthContext);\n"]},"metadata":{},"sourceType":"module"}